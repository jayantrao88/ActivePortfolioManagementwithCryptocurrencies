---
title: "6b Report Generation CryptoFund"
output: html_notebook
---


1) Performance Metrics
2) Evolution Graphs
3) Weight over a period of Time Graphs
4) Correlation and Copula Dependence Numbers and Graphs
5) R and C Copula Tree Graphs



1) Performance Metrics
Conventional
```{r}
OptimizationMethod <- c("Naive", "MinSD", "MinES", "Sharpe", "Starr", "MaxMean")
Metric <- NULL
Metric <- as.data.frame(ConvPerformanceMetrics[,c("SP500","BTC","LTC","XRP","XMR","ETH","EOS","BCH")])
colnames(Metric) <- c("SP500","BTC","LTC","XRP","XMR","ETH","EOS","BCH")
for(Optim in 1:length(OptimizationMethod)){

    dataTemp <- NULL
    dataTemp <- as.data.frame(ConvPerformanceMetrics[,OptimizationMethod[Optim]])
    colnames(dataTemp) <- paste("Conventional",OptimizationMethod[Optim],sep = ".")
    Metric <- cbind(Metric,dataTemp)

}
rm(OptimizationMethod,Optim, dataTemp)
```
Copula
```{r}
CopulaType <- c("P.R","P.C", "E.R", "E.C")
OptimizationMethod <- c("Naive", "MinSD", "MinES", "Sharpe", "Starr", "MaxMean")

for(Cop in 1:4){
  for(Optim in 1:length(OptimizationMethod)){
          dataTemp <- a <- NULL
          a <- paste(CopulaType[Cop],OptimizationMethod[Optim], sep = ".")  
          dataTemp <- as.data.frame(PerformanceMetrics[,a])
          colnames(dataTemp) <- paste(CopulaType[Cop],OptimizationMethod[Optim],sep = ".")
          Metric <- cbind(Metric,dataTemp) 
    }
  }

Metric <- t(Metric)
rm(OptimizationMethod,Optim, dataTemp, Cop,a,CopulaType)
```

```{r}
Metric2 <- data.frame(matrix(data=NA,nrow = 8+6+24, ncol  = 6,dimnames=list(NULL,c("Dependence", "Copula","Optimization","Mean","SD","CAGR"))))

#Individual Assets
Metric2[1:8,c(1,4,5,6)] <-c(rownames(t(PerformanceMetrics[,1:8])),
                            t(PerformanceMetrics[,1:8]))
Metric2[1:8,c(2,3)] <- rownames(t(PerformanceMetrics[,1:8]))

#Conventional
Metric2[9:14,c(3,4,5,6)] <- c(rownames(t(ConvPerformanceMetrics[,-c(1:8)])),
                            t(ConvPerformanceMetrics[,-c(1:8)]))
Metric2[9:14,c(1,2)] <- "Conventional"


#Copula
Metric2[-c(1:14),1] <- "Copula"
Metric2[-c(1:14),c(2,4,5,6)] <-  c(rownames(t(PerformanceMetrics[,-c(1:8)])),
                            t(PerformanceMetrics[,-c(1:8)]))

OptimizationMethod <- c(".Naive", ".MinSD", ".MinES", ".Sharpe", ".Starr", ".MaxMean")
Optimization <- c("Naive", "MinSD", "MinES", "Sharpe", "Starr", "MaxMean")
for(i in 1: length(OptimizationMethod)){
Metric2[grepl(OptimizationMethod[i],Metric2$Copula),3] <- Optimization[i]
Metric2[grepl(OptimizationMethod[i],Metric2$Copula),2] <- unlist(strsplit(Metric2[grepl(OptimizationMethod[i],Metric2$Copula),2],OptimizationMethod[i]))
}

rm(i,Optimization,OptimizationMethod)

```


2) Portfolio Evolution
```{r}
PortfolioEvolution <- cbind.data.frame(Date = as.Date(index(PortfolioEvolution, format = "%Y-%m-%d")),coredata(PortfolioEvolution))

ConvPortfolioEvolution <- cbind.data.frame(Date = as.Date(index(ConvPortfolioEvolution, format = "%Y-%m-%d")),coredata(ConvPortfolioEvolution))

SP500Evolution <- cbind.data.frame(Date = as.Date(index(SP500Evolution, format = "%Y-%m-%d")),coredata(SP500Evolution))

IndividualEvolution <- cbind.data.frame(Date = as.Date(index(IndividualEvolution, format = "%Y-%m-%d")),coredata(IndividualEvolution))

```


3) Asset Weights in a Portfolio over the period.

Optimizationwise Asset Weights in a Portfolio
```{r}
library(rlist)
OptimizationMethod <- c("Naive", "MinSD", "MinES", "Sharpe", "Starr", "MaxMean")
OptimizationWisePortWeights <- list()
for(optim in 1:length(OptimizationMethod)){
  a <- data.frame(index(ConvPortfolioWeights[[OptimizationMethod[optim]]]),
                  data.frame(coredata(ConvPortfolioWeights[[OptimizationMethod[optim]]])))
  names(a)[1] <- "Dates"
  OptimizationWisePortWeights <- list.append(OptimizationWisePortWeights,a)
  rm(a)
}
names(OptimizationWisePortWeights) <- paste("Conv.",OptimizationMethod,sep = "")
rm(optim)

CopType <- c("P.R","P.C","E.R","E.C")
for(optim in 1:length(OptimizationMethod)){
    for(Cop in 1:4){
      a <- data.frame(index(PortfolioWeights[[optim]][[Cop]]),
                      data.frame(coredata(PortfolioWeights[[optim]][[Cop]])))
      names(a)[1] <- "Dates"
      OptimizationWisePortWeights <- list.append(OptimizationWisePortWeights,a)
      rm(a)
    }
  j <- length(OptimizationWisePortWeights)
  names(OptimizationWisePortWeights)[(j-3):j] <- gsub(x = names(PortfolioWeights[[optim]]),".Weights","")
  rm(j)
}

rm(optim,Cop,CopType)
```

Assetwise Weights for Optimization Types.

```{r}
ElementName <- names(OptimizationWisePortWeights[["Conv.Naive"]])[c(-1)]
dt <- select(OptimizationWisePortWeights[["Conv.Naive"]]) 
AssetWiseWeights <- list()
for (element in ElementName){
  tem <- dt
for(i in 1:length(OptimizationWisePortWeights)){
  tem2 <- select(OptimizationWisePortWeights[[i]], element)
  colnames(tem2) <- names(OptimizationWisePortWeights)[i]
 tem <- cbind.data.frame(tem,tem2)
}
AssetWiseWeights <- list.append(AssetWiseWeights,  tem)
rm(tem,tem2)
}
names(AssetWiseWeights) <- ElementName
rm(ElementName,dt)
```


Graphing the plots

Evolution - Portfolio , SP500, and Individual Cryptos
```{r}
library(ggplot2)

Indiv <- merge(SP500Evolution, IndividualEvolution)

Indiv <- reshape2::melt(Indiv, id.var='Date')

cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
ggplot(
  subset(Indiv, variable %!in% c("XRP","BTC")),aes(Date,value)) + geom_line(aes(color = variable)) + scale_colour_manual(values=cbbPalette) + scale_x_date(limits = as.Date(c("2019-01-22","2020-04-11"))) + scale_y_continuous(limits = as.numeric(c(0,10)))

ggplot(Indiv,aes(Date,value)) + geom_line(aes(color = variable)) + scale_colour_manual(values=cbbPalette) + scale_x_date(limits = as.Date(c("2019-01-22","2020-04-11"))) + scale_y_continuous(limits = as.numeric(c(0,10)))
  

ggplot(Indiv,aes(Date,value)) + geom_line() + scale_colour_manual(values=cbbPalette)  + facet_wrap(~variable, scales = "free_y")



```


Portfolio Evolution
```{r}
Port <-  reshape2::melt(PortfolioEvolution, id.var='Date')

Port$variable <-gsub(x = Port$variable, ".Returns", "")


ggplot(subset(Port, variable %!in% c("P.R.Naive","P.C.Naive","E.R.Naive")),aes(Date,value)) + geom_line() + scale_colour_manual(values=cbbPalette)  + facet_wrap(~variable, scales = "free_y")

ggplot(subset(Port, variable %!in% c("P.R.Naive","P.C.Naive","E.R.Naive")),aes(Date,value)) + geom_line() + scale_colour_manual(values=cbbPalette)  + facet_wrap(~variable)

ggplot(subset(Port, variable %!in% c("P.R.Naive","P.C.Naive","E.R.Naive")),aes(Date,value)) + geom_line() + scale_colour_manual(values=cbbPalette)  + facet_wrap(~variable,scales = "free_y") + scale_x_date(limits = as.Date(c("2019-01-22","2020-04-11"))) 



```




```{r}
b <- c("MaxMean", "Naive","MinES")
d <- c("Conventional","P.R","P.C")

c <- data.frame(matrix(ncol= 6, nrow = 0))
colnames(c) <- colnames(Metric2)
for(i in 1:length(b)){
  for (j in 1:length(d)){
      a <- Metric2[which(Metric2$Optimization == b[i] & Metric2$Copula == d[j]),]
      c <- rbind(c,a) 
      }
    }
```






############################## EXTRAS ##########################################################################
Conventional 
```{r}
library(reshape2)

LongConvPortfolioWeights <- NULL

OptimizationMethod <- c("Naive", "MinSD", "MinES", "Sharpe", "Starr", "MaxMean")
  for(optim in 1:length(OptimizationMethod)){
    a <- data.frame(index(ConvPortfolioWeights[[OptimizationMethod[optim]]]),
                    data.frame(coredata(ConvPortfolioWeights[[OptimizationMethod[optim]]])))
    names(a)[1] <- "Dates"
    a <- melt(a, id.vars = "Dates")
    names(a)[2:3] <- c("Asset","Weights")
    a <- data.frame(a, data.frame(optim = rep(OptimizationMethod[optim],nrow(a))))
    a <- data.frame(a, data.frame(Type = rep("Conventional",nrow(a))))
    LongConvPortfolioWeights <- rbind(LongConvPortfolioWeights, a)
  }
rm(OptimizationMethod,optim,a)
```

Copula
```{r}
LongPortfolioWeights <- NULL
Port <- c("Base", "Alt")
OptimizationMethod <- c("Naive", "MinSD", "MinES", "Sharpe", "Starr", "MaxMean")
CopType <- c("P.R","P.C","E.R","E.C")

for(PortType in 1:2){
  for(optim in 1:length(OptimizationMethod)){
    for(Cop in 1:4){
      a <- data.frame(index(PortfolioWeights[[Port[PortType]]][[optim]][[Cop]]),
                      data.frame(coredata(PortfolioWeights[[Port[PortType]]][[optim]][[Cop]])))
      names(a)[1] <- "Dates"
      a <- melt(a, id.vars = "Dates")
      names(a)[2:3] <- c("Asset","Weights")
      a <- data.frame(a, data.frame(optim = rep(OptimizationMethod[optim],nrow(a))))
      a <- data.frame(a, data.frame(Type = rep(CopType[Cop],nrow(a))))
      a <- data.frame(a, data.frame(PortType = rep(Port[PortType],nrow(a))))
      LongPortfolioWeights <- rbind(LongPortfolioWeights, a)
      }  
  }
}

AllPortfolioWeights <- rbind(LongPortfolioWeights,LongConvPortfolioWeights)

rm(LongPortfolioWeights,LongConvPortfolioWeights)  
```

Graph of Asset Weights
```{r}
opt <- c("Naive","MinSD","MinES","Sharpe","Starr","MaxMean")
Type <- c("P.R","P.C","E.R","E.C")
PortType <- c("Base","Alt")

a <- AllPortfolioWeights
b <- subset(a, optim == opt[3] & Type == Type[1] & PortType == PortType[2])



rm(opt,Type,PortType,a)
```



```{r}
library(ggplot2)

ggplot(AllPortfolioWeights,aes(Dates,Weights)) + geom_point() + facet_wrap(optim~Asset)
```

